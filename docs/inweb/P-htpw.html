<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>How This Program Works</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script src="http://code.jquery.com/jquery-1.12.4.min.js"
	integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

<script src="../docs-assets/Bigfoot.js"></script>
<link href="../docs-assets/Bigfoot.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<h1><a href="../index.html">
<img src="../docs-assets/Octagram.png" width=72 height=72">
</a></h1>
<ul><li><a href="index.html"><span class="selectedlink">inweb</span></a></li>
</ul><h2>Foundation Module</h2><ul>
<li><a href="../foundation-module/index.html">foundation</a></li>
<li><a href="../foundation-test/index.html">foundation-test</a></li>
</ul><h2>Example Webs</h2><ul>
<li><a href="../goldbach/index.html">goldbach</a></li>
<li><a href="../twinprimes/twinprimes.html">twinprimes</a></li>
<li><a href="../eastertide/index.html">eastertide</a></li>
</ul><h2>Repository</h2><ul>
<li><a href="https://github.com/ganelson/inweb"><img src="../docs-assets/github.png" height=18> github</a></li>
</ul><h2>Related Projects</h2><ul>
<li><a href="../../../inform/docs/index.html">inform</a></li>
<li><a href="../../../intest/docs/index.html">intest</a></li>

</ul>
		</nav>
		<main role="main">
		<!-- Weave of 'How This Program Works' generated by inweb -->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">inweb</a></li><li><a href="index.html#P">Preliminaries</a></li><li><b>How This Program Works</b></li></ul></div>
<p class="purpose">An overview of how Inweb works, with links to all of its important functions.</p>

<ul class="toc"><li><a href="P-htpw.html#SP1">&#167;1. Prerequisites</a></li><li><a href="P-htpw.html#SP2">&#167;2. Working out what to do, and what to do it to</a></li><li><a href="P-htpw.html#SP4">&#167;4. Taking action</a></li><li><a href="P-htpw.html#SP5">&#167;5. Adding to Inweb</a></li></ul><hr class="tocbar">

<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a><b>&#167;1. Prerequisites.</b>This page is to help readers to get their bearings in the source code for
Inweb, which is a literate program or "web". Before diving in:
</p>

<ul class="items"><li>(a) It helps to have some experience of reading webs. The short examples
<a href="../goldbach/index.html" class="internal">goldbach</a> and <a href="../twinprimes/twinprimes.html" class="internal">twinprimes</a> are enough to give the idea.
</li><li>(b) Inweb is written in C, in fact ANSI C99, but this is disguised by the
fact that it uses some extension syntaxes provided by <a href="index.html" class="internal">inweb</a> itself.
Turn to <a href="M-tid.html" class="internal">The InC Dialect</a> for full details, but essentially: it's plain
old C without predeclarations or header files, and where functions have names
like <span class="extract"><span class="extract-syntax">LiterateSource::tag_paragraph</span></span> rather than just <span class="extract"><span class="extract-syntax">add_by_name</span></span>.
</li><li>(c) Inweb makes use of a "module" of utility functions called <a href="../foundation-module/index.html" class="internal">foundation</a>.
Indeed, as will become quickly apparent, almost its entire functionality is
carried out by foundation: Inweb itself is little more than a command-line
interface to control what is done. See <a href="../foundation-module/P-abgtf.html" class="internal">A Brief Guide to Foundation (in foundation)</a>.
</li></ul>
<p class="commentary firstcommentary"><a id="SP2" class="paragraph-anchor"></a><b>&#167;2. Working out what to do, and what to do it to.</b>Inweb is a C program, so it begins at <a href="1-pc.html#SP5" class="internal">main</a>, in <a href="1-pc.html" class="internal">Program Control</a>. PC
works out where Inweb is installed, then calls <a href="1-cnf.html" class="internal">Configuration</a>, which
<a href="1-cnf.html#SP2" class="internal">reads the command line options</a>.
</p>

<p class="commentary">The user's choices are stored in an <a href="1-cnf.html#SP1" class="internal">inweb_instructions</a> object, and Inweb
is put into one of four modes: <span class="extract"><span class="extract-syntax">TANGLE_MODE</span></span>, <span class="extract"><span class="extract-syntax">WEAVE_MODE</span></span>, <span class="extract"><span class="extract-syntax">ANALYSE_MODE</span></span>, or
<span class="extract"><span class="extract-syntax">TRANSLATE_MODE</span></span>.<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> Inweb never changes mode: once set, it remains
for the rest of the run. Inweb also acts on only one main web in any run,
unless in <span class="extract"><span class="extract-syntax">TRANSLATE_MODE</span></span>, in which case none.
</p>

<p class="commentary">Once it has worked through the command line, <a href="1-cnf.html" class="internal">Configuration</a> reads in the
colony file, if one was given (see <a href="M-mwiw.html" class="internal">Making Weaves into Websites</a>), and uses
this to preset some settings: see <a href="1-cnf.html#SP4" class="internal">Configuration::member_and_colony</a>.
</p>

<p class="commentary">All errors in configuration are sent to <a href="../foundation-module/3-em.html#SP2" class="internal">Errors::fatal</a>, from whose bourne
no traveller returns.
</p>

<ul class="footnotetexts"><li class="footnote" id="fn:1"><p class="inwebfootnote"><sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> Tangling and weaving are fundamental to all LP tools. Analysis means, say,
reading a web and listing functions in it. Translation is for side-activities
like making makefiles. Strictly speaking there is also <span class="extract"><span class="extract-syntax">NO_MODE</span></span> for runs where
the user simply asked for <span class="extract"><span class="extract-syntax">-help</span></span> at the command line.
<a href="#fnref:1" title="return to text"> &#x21A9;</a></p></li></ul>
<p class="commentary firstcommentary"><a id="SP3" class="paragraph-anchor"></a><b>&#167;3. </b><a href="1-pc.html" class="internal">Program Control</a> then resumes, calling <a href="1-pc.html#SP6" class="internal">Main::follow_instructions</a> to
act on the <a href="1-cnf.html#SP1" class="internal">inweb_instructions</a> object. If the user did specify a web to
work on, PC then goes through three stages to understand it.
</p>

<p class="commentary">First, PC calls <a href="1-pc.html#SP7" class="internal">Main::load_web</a> to read the web fully into memory &mdash; not
only metadata such as its title, author, and section breakdown, but also the
completely parsed text of the source. (It's possible to read webs only partially
as metadata alone for speed, but we don't do that.) All this work is delegated to
the foundation library, so if you're interested in how it's done, and in how
webs are stored in memory, see there. The result, put briefly, is a single
<a href="../foundation-module/8-ws.html#SP1" class="internal">ls_web</a> object, containing a list of <a href="../foundation-module/8-ws.html#SP5" class="internal">ls_chapter</a> objects for each chapter,
each of which in turn is a list of <a href="../foundation-module/8-ws.html#SP6" class="internal">ls_section</a> objects for each section.
There is always at least one <a href="../foundation-module/8-ws.html#SP5" class="internal">ls_chapter</a>, each of which
has at least one <a href="../foundation-module/8-ws.html#SP6" class="internal">ls_section</a>.<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup> The "range text" for each chapter and
section is set along the way, which affects leafnames used in woven websites.<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup>
</p>

<p class="commentary">Where a web imports a module, as for instance the <a href="../eastertide/index.html" class="internal">eastertide</a> example does,
<a href="../foundation-module/8-ws.html#SP10" class="internal">WebStructure::get</a> creates a <a href="../foundation-module/8-wm.html#SP2" class="internal">ls_module</a> object for each import. In any event,
it also creates a module called <span class="extract"><span class="extract-syntax">"(main)"</span></span> to represent the main, non-imported,
part of the overall program. Each module object also refers to the <a href="../foundation-module/8-ws.html#SP5" class="internal">ls_chapter</a>
and <a href="../foundation-module/8-ws.html#SP6" class="internal">ls_section</a> objects.<sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup>
</p>

<ul class="footnotetexts"><li class="footnote" id="fn:2"><p class="inwebfootnote"><sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup> For single-file webs like <a href="../twinprimes/twinprimes.html" class="internal">twinprimes</a>, with no contents pages, Inweb
makes what it calls an "implied" chapter and section heading.
<a href="#fnref:2" title="return to text"> &#x21A9;</a></p></li><li class="footnote" id="fn:3"><p class="inwebfootnote"><sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup> Range texts are used at the command line, and in <span class="extract"><span class="extract-syntax">-catalogue</span></span> output, for
example; and also to determine leafnames of pages in a website being woven.
A range is really just an abbreviation. For example, <span class="extract"><span class="extract-syntax">M</span></span> is the range for the
Manual chapter, <span class="extract"><span class="extract-syntax">2/tp</span></span> for the section "The Parser" in Chapter 2.
<a href="#fnref:3" title="return to text"> &#x21A9;</a></p></li><li class="footnote" id="fn:4"><p class="inwebfootnote"><sup id="fnref:4"><a href="#fn:4" rel="footnote">4</a></sup> The difference is that the <a href="../foundation-module/8-ws.html#SP1" class="internal">ls_web</a> lists every chapter and section,
imported or not, whereas the <a href="../foundation-module/8-wm.html#SP2" class="internal">ls_module</a> lists only those falling under its
own aegis.
<a href="#fnref:4" title="return to text"> &#x21A9;</a></p></li></ul>
<p class="commentary firstcommentary"><a id="SP4" class="paragraph-anchor"></a><b>&#167;4. Taking action.</b>Let's get back to <a href="1-pc.html" class="internal">Program Control</a>, which has now set everything up and is
about to take action. What it does depends on which of the four modes Inweb
is in: <span class="extract"><span class="extract-syntax">WEAVE_MODE</span></span>, <span class="extract"><span class="extract-syntax">TANGLE_MODE</span></span>,  <span class="extract"><span class="extract-syntax">ANALYSE_MODE</span></span> or <span class="extract"><span class="extract-syntax">TRANSLATE_MODE</span></span>.
The latter amounts to very little, and is simply a catchall name for generating
convenient addenda to webs of source code: makefiles, gitignore files and such.
</p>

<p class="commentary">And that is essentially it. Inweb winds up by returning exit code 1 if there
were errors, or 0 if not, like a good Unix citizen.
</p>

<p class="commentary firstcommentary"><a id="SP5" class="paragraph-anchor"></a><b>&#167;5. Adding to Inweb.</b>Here's some miscellaneous advice for those who would like to add to Inweb:
</p>

<p class="commentary">1. To add a new command-line switch, declare at <a href="1-cnf.html#SP2" class="internal">Configuration::read</a> and
add a field to <a href="1-cnf.html#SP1" class="internal">inweb_instructions</a> which holds the setting; don't act on it
then and there, only in <a href="1-pc.html" class="internal">Program Control</a> later. But we don't want these
settings to proliferate: ask first if adding a feature to, say, <a href="../foundation-module/11-cl.html" class="internal">Colonies (in foundation)</a>
or <a href="../foundation-module/10-pt.html#SP1" class="internal">weave_pattern</a> files would meet the same need.
</p>

<p class="commentary">2. To add new programming languages, try if possible to do everything you
need with a new definition file alone: see <a href="M-spl.html" class="internal">Supporting Programming Languages</a>.
Failing that, foundation will need to be added to. see if making definition
files more powerful would do it (for example, by making the ACME support more
general-purpose). Failing even that, follow the model of <a href="../foundation-module/9-cl.html" class="internal">C-Like Languages (in foundation)</a>:
that is, add logic to <a href="../foundation-module/9-pl.html#SP6" class="internal">Languages::read_definition</a> which adds receiver functions
to a language with a given name, or, preferably, some given declaration in the
language definition file. On no account insert any language bias into
<a href="../foundation-module/10-tw.html" class="internal">The Weaver (in foundation)</a> or <a href="../foundation-module/8-tt2.html" class="internal">The Tangler (in foundation)</a>.
</p>

<p class="commentary">3. To add new forms of weave output, try if possible to make a new pattern:
see <a href="M-awwp.html" class="internal">Advanced Weaving with Patterns</a>. But this won't always be good enough.
For example, "an HTML website but done differently" should be a pattern based
on HTML.
</p>

<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprev"><a href="M-rc.html">&#10094;</a></li><li class="progresschapter"><a href="M-iti.html">M</a></li><li class="progresscurrentchapter">P</li><li class="progresscurrent">htpw</li><li class="progresschapter"><a href="1-bsc.html">1</a></li><li class="progressnext"><a href="1-bsc.html">&#10095;</a></li></ul></div>
</nav><!-- End of weave -->

		</main>
	</body>
</html>

